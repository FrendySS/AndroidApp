stages:
  - setup
  - build

variables:
  ANDROID_COMPILE_SDK: "34"
  ANDROID_BUILD_TOOLS: "34.0.0"
  ANDROID_SDK_ROOT: "/sdk"
  GRADLE_OPTS: "-Dorg.gradle.daemon=false"

setup:
  stage: setup
  image: ghcr.io/cirruslabs/android-sdk:34
  script:
    - export GRADLE_USER_HOME="${CI_PROJECT_DIR}/.gradle"
    - chmod +x ./gradlew
    - echo "sdk.dir=${ANDROID_HOME}" > local.properties
    - yes | sdkmanager --licenses
  artifacts:
    paths:
      - .gradle
    expire_in: 1h

build:
  stage: build
  image: ghcr.io/cirruslabs/android-sdk:34
  script:
    - export GRADLE_USER_HOME="${CI_PROJECT_DIR}/.gradle"
    - ./gradlew assembleDebug
  dependencies:
    - setup
  artifacts:
    paths:
      - app/build/outputs/
    expire_in: 1h

after_script:
  - echo "ðŸ§¹ Cleaning up after pipeline"
  - rm -f local.properties
  - ./gradlew --stop || true
